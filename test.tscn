[gd_scene format=4 uid="uid://bxbp22g2lx7b6"]

[ext_resource type="Script" uid="uid://cepcdh8670vhd" path="res://Systems/ProceduralGen/ProceduralRoomGenerator.cs" id="1_ppyta"]
[ext_resource type="Script" uid="uid://voxy632bro1g" path="res://Systems/ProceduralGen/RoomsDebugVisualizer.cs" id="2_ppyta"]
[ext_resource type="Script" uid="uid://c1lgu0x34m5h2" path="res://Systems/TestScript.cs" id="3_ykrsh"]
[ext_resource type="Resource" uid="uid://rknxtcpf0hkc" path="res://Systems/ProceduralGen/Data/base_procgen.tres" id="4_g14j6"]
[ext_resource type="Resource" uid="uid://cfrfxh7vllrky" path="res://ruleset.tres" id="5_g14j6"]
[ext_resource type="TileSet" uid="uid://cub01tq8ncrlk" path="res://Entities/World/pool_tileset.tres" id="5_ykrsh"]
[ext_resource type="TileSet" uid="uid://ct3mbd7ksnekn" path="res://Entities/World/collision_tileset.tres" id="6_77dp3"]
[ext_resource type="PackedScene" uid="uid://bnjweurtnnx4f" path="res://Entities/Player/player.tscn" id="10_00tp4"]
[ext_resource type="PackedScene" uid="uid://dvxen8vg3bed0" path="res://Entities/Enemies/Testing/dummy_enemy.tscn" id="10_77dp3"]
[ext_resource type="Script" uid="uid://c142d3ds7lke8" path="res://Common/Interaction/Interactable.cs" id="12_5tkv4"]

[sub_resource type="GDScript" id="GDScript_ppyta"]
resource_name = "camera_movement"
script/source = "extends Camera2D

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.

@export var player: Node2D

var is_following := true

var last_pos: Vector2
var current_pos: Vector2

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	if is_following:
		global_position = player.global_position
	current_pos = get_local_mouse_position()
	var delta_pos := last_pos - current_pos
	last_pos = current_pos
	
	if Input.is_mouse_button_pressed(MOUSE_BUTTON_MIDDLE) or (
		Input.is_key_pressed(KEY_ALT) and Input.is_mouse_button_pressed(MOUSE_BUTTON_LEFT)
	):
		position += delta_pos

func _input(event: InputEvent) -> void:
	if event is InputEventMouseButton and event.is_pressed():
		if event.button_index == MOUSE_BUTTON_WHEEL_UP:
			zoom *= 2
		elif event.button_index == MOUSE_BUTTON_WHEEL_DOWN:
			zoom /= 2
	elif event is InputEventKey and event.is_pressed():
		if event.keycode == KEY_EQUAL:
			zoom *= 2
		elif event.keycode == KEY_MINUS:
			zoom /= 2
		elif event.keycode == KEY_TAB:
			is_following = !is_following
			position_smoothing_enabled = is_following
"

[sub_resource type="GDScript" id="GDScript_ykrsh"]
script/source = "extends Label

@onready var camera_2d: Camera2D = $\"../../Camera2D\"


# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(_delta: float) -> void:
	text = \"Zoom: %s\" % camera_2d.zoom
"

[sub_resource type="GDScript" id="GDScript_00tp4"]
resource_name = "toggle_debug_renderer"
script/source = "extends CheckBox

@export var rooms_debug_visualizer: Node2D

func _on_toggled(toggled_on: bool) -> void:
	rooms_debug_visualizer.visible = toggled_on
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_0m0f1"]

[sub_resource type="GDScript" id="GDScript_5tkv4"]
resource_name = "test_callback"
script/source = "extends Node


func _on_interactable_interacted(interactor: Area2D) -> void:
	print(\"Interaction happened!!!\")
"

[node name="Test" type="Node2D" unique_id=81459051]
physics_interpolation_mode = 2

[node name="RoomGenerator" type="Node" parent="." unique_id=2095976244]
script = ExtResource("1_ppyta")

[node name="RoomsDebugVisualizer" type="Node2D" parent="." unique_id=89596583 node_paths=PackedStringArray("_generator")]
z_index = 100
scale = Vector2(2, 2)
script = ExtResource("2_ppyta")
_generator = NodePath("../RoomGenerator")

[node name="Camera2D" type="Camera2D" parent="." unique_id=17372746 node_paths=PackedStringArray("player")]
position_smoothing_enabled = true
script = SubResource("GDScript_ppyta")
player = NodePath("../Environmental Objects/Player")

[node name="CanvasLayer" type="CanvasLayer" parent="." unique_id=1893954925]

[node name="LineEdit" type="LineEdit" parent="CanvasLayer" unique_id=79803838]
offset_left = 372.0
offset_top = 228.0
offset_right = 576.0
offset_bottom = 264.0
scale = Vector2(0.5, 0.5)
placeholder_text = "Enter seed..."

[node name="Test Button" type="Button" parent="CanvasLayer" unique_id=43627872 node_paths=PackedStringArray("Generator", "PropsGroup", "AutoTileLayer", "CollisionsLayer", "SeedInput")]
offset_left = 386.0
offset_top = 248.0
offset_right = 538.0
offset_bottom = 279.0
scale = Vector2(0.5, 0.5)
text = "Generate"
script = ExtResource("3_ykrsh")
Generator = NodePath("../../RoomGenerator")
Settings = ExtResource("4_g14j6")
PropsGroup = NodePath("../../Environmental Objects/Props")
AutoTileLayer = NodePath("../../Environmental Objects/VisualAutoTileLayer")
CollisionsLayer = NodePath("../../CollisionTilesLayer")
RuleSet = ExtResource("5_g14j6")
SeedInput = NodePath("../LineEdit")

[node name="Label" type="Label" parent="CanvasLayer" unique_id=2103677277]
offset_right = 154.0
offset_bottom = 23.0
text = "Zoom: "
script = SubResource("GDScript_ykrsh")

[node name="CheckBox" type="CheckBox" parent="CanvasLayer" unique_id=37312457 node_paths=PackedStringArray("rooms_debug_visualizer")]
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -124.0
offset_bottom = 31.0
grow_horizontal = 0
scale = Vector2(0.5, 0.5)
pivot_offset = Vector2(124, 0)
button_pressed = true
text = "Debug Draw"
script = SubResource("GDScript_00tp4")
rooms_debug_visualizer = NodePath("../../RoomsDebugVisualizer")

[node name="CollisionTilesLayer" type="TileMapLayer" parent="." unique_id=1156224380]
modulate = Color(1, 1, 1, 0.39215687)
texture_filter = 1
tile_set = ExtResource("6_77dp3")

[node name="Environmental Objects" type="Node2D" parent="." unique_id=1823721867]
y_sort_enabled = true

[node name="Player" parent="Environmental Objects" unique_id=1528480435 instance=ExtResource("10_00tp4")]
physics_interpolation_mode = 1
position = Vector2(-37, 8)

[node name="Dummy Enemy" parent="Environmental Objects" unique_id=1902365087 instance=ExtResource("10_77dp3")]
position = Vector2(100, 9)

[node name="Props" type="Node2D" parent="Environmental Objects" unique_id=1888682377]
y_sort_enabled = true

[node name="VisualAutoTileLayer" type="TileMapLayer" parent="Environmental Objects" unique_id=1865007474]
y_sort_enabled = true
texture_filter = 1
tile_map_data = PackedByteArray("AAD8/wYAAQAAAAAAAAD8/wcAAQAAAAEAAAD8/wMAAQAFAAAAAAD8/wQAAQAFAAEAAAD8/wUAAQAFAAIAAAD//wMAAQAFAAAAAAD//wQAAQAFAAEAAAD//wUAAQAFAAIAAAD//wYAAQAAAAAAAAD//wcAAQAAAAEAAAD9/wcAAQABAAAAAAD9/wYAAQABAAAAAAD9/wUAAQABAAAAAAD9/wQAAQABAAAAAAD+/wQAAQABAAAAAAD+/wUAAQABAAAAAAD+/wYAAQABAAAAAAD+/wcAAQABAAAAAAD7/wgAAQABAAAAAAD8/wgAAQABAAAAAAD9/wgAAQABAAAAAAD+/wgAAQABAAAAAAD//wgAAQABAAAAAAAAAAgAAQABAAAAAAD5/wIAAQABAAAAAAD6/wIAAQABAAAAAAD7/wIAAQABAAAAAAD8/wIAAQABAAAAAAD9/wIAAQABAAAAAAD+/wIAAQABAAAAAAD//wIAAQABAAAAAAAAAAIAAQABAAAAAAABAAIAAQABAAAAAAACAAIAAQABAAAAAAABAAMAAQABAAAAAAABAAQAAQABAAAAAAABAAUAAQABAAAAAAABAAYAAQABAAAAAAABAAcAAQABAAAAAAABAAgAAQABAAAAAAABAAkAAQABAAAAAAABAAoAAQABAAAAAAACAAMAAQABAAAAAAACAAQAAQABAAAAAAACAAUAAQABAAAAAAACAAYAAQABAAAAAAACAAcAAQABAAAAAAACAAgAAQABAAAAAAACAAkAAQABAAAAAAACAAoAAQABAAAAAAD5/wkAAQABAAAAAAD5/woAAQABAAAAAAD6/wkAAQABAAAAAAD6/woAAQABAAAAAAD7/wkAAQABAAAAAAD7/woAAQABAAAAAAD8/wkAAQABAAAAAAD8/woAAQABAAAAAAD9/wkAAQABAAAAAAD9/woAAQABAAAAAAD+/wkAAQABAAAAAAD+/woAAQABAAAAAAD//wkAAQABAAAAAAD//woAAQABAAAAAAAAAAkAAQABAAAAAAAAAAoAAQABAAAAAAD5/wMAAQABAAAAAAD5/wQAAQABAAAAAAD5/wUAAQABAAAAAAD5/wYAAQABAAAAAAD5/wcAAQABAAAAAAD5/wgAAQABAAAAAAD6/wMAAQABAAAAAAD6/wQAAQABAAAAAAD6/wUAAQABAAAAAAD6/wYAAQABAAAAAAD6/wcAAQABAAAAAAD6/wgAAQABAAAAAAD7/wMAAQABAAAAAAD7/wQAAQABAAAAAAD7/wUAAQABAAAAAAD7/wYAAQABAAAAAAD7/wcAAQABAAAAAAD9/wMAAQABAAAAAAD+/wMAAQABAAAAAAAAAAMAAQABAAAAAAAAAAQAAQABAAAAAAAAAAUAAQABAAAAAAAAAAYAAQABAAAAAAAAAAcAAQABAAAAAAA=")
tile_set = ExtResource("5_ykrsh")

[node name="Interactable" type="Area2D" parent="." unique_id=1604597610]
position = Vector2(134, 90)
collision_layer = 256
collision_mask = 256
script = ExtResource("12_5tkv4")
metadata/_custom_type_script = "uid://c142d3ds7lke8"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Interactable" unique_id=322732445]
shape = SubResource("RectangleShape2D_0m0f1")
debug_color = Color(0.95218855, 0.68952936, 0, 0.41960785)

[node name="Test logger" type="Node" parent="Interactable" unique_id=2047213991]
script = SubResource("GDScript_5tkv4")

[connection signal="pressed" from="CanvasLayer/Test Button" to="CanvasLayer/Test Button" method="_on_pressed"]
[connection signal="toggled" from="CanvasLayer/CheckBox" to="CanvasLayer/CheckBox" method="_on_toggled"]
[connection signal="Interacted" from="Interactable" to="Interactable/Test logger" method="_on_interactable_interacted"]
